<!--
 * @Author: your name
 * @Date: 2021-01-11 17:40:30
 * @LastEditTime: 2021-01-15 18:05:52
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \canvas\src\index.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="./js/gifshot.js" type="module"></script>
    <script src="./js/index.js" type="module"></script> -->
    <script src="../dependencies/vue.global.js"></script>
    <title>canvas</title>
</head>
<style>
    .main {
        width: 400px;
        height: auto;
        background: #000;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        padding-bottom: 50px;
    }

    .video {
        width: 200px;
    }
    .timeline {
        width: 100%;
        height: 50px;
        position: absolute;
        bottom: 0;
        background: #fff;
    }
    .timelineArea{
        width: 50px;
        height: 100%;
        background: red;
        opacity: 0.5;
        cursor: pointer;
    }
</style>

<body>
    <div id="app">
        <div class="main">
            <video class="video" src="./img/2.mp4" controls autoplay></video>
            <div class="timeline">
                <div class="timelineArea" :style="marginLeft" @mouseleave="mouseleave" @mouseup="mouseup" @mousemove="mousemove" @mousedown="mousedown"></div>
            </div>
        </div>
    </div>

</body>
 <script>
    const { createApp, ref, watch } = Vue
    createApp({
        setup() {
            let a = ref(112211)
            // 是否按下
            let status = ref(false)
            // 距离
            let distance = ref(0)
            // 返回style样式
            let marginLeft = ref('')
            // x坐标变换情况
            let x = ref(0)
            
            const mousedown = () => {
                status.value = true
            }
            const mouseup = () => {
                status.value = false
            }
            const mouseleave = () => {
                status.value = false
            }
            // watch((e) => distance.value, (newValue, oldValue) => {
            //     if (newValue > oldValue) {
                    
            //     } else {
                    
            //     }
            // })
            const mousemove = (e) => {
                if (status.value) {
                    marginLeft.value = `margin-left:${++distance.value}px`
                }
            }
            return {
                mousemove,
                mousedown,
                mouseup,
                marginLeft,
                mouseleave
            }
        }
    }).mount('#app')
    let video = document.querySelector('.video')
    let img = document.createElement('img')
    let canvas = document.createElement('canvas')
    let ctx = canvas.getContext('2d')
    // 当前时间
    let curDuration = 1
    // 多少时间间隔下载一张图片
    const time = 40
    video.onloadeddata = () => {
        // video.currentTime = curDuration
        canvas.width = video.clientWidth
        canvas.height = video.clientHeight
    }
    // 当播放位置改变时,进度条
    video.ontimeupdate = () => {
        // draw(video.duration)
        console.log('改变',video.currentTime,curDuration)
    }
    const draw = (duration) => {
        if (curDuration > duration)  {
            video.pause()
            return false
        }			
        ctx.drawImage(video, 0, 0, video.clientWidth, video.clientHeight) 
        img.src = canvas.toDataURL('image/jpeg', 1)
        img.onload = () => {
            downImg(img.src)
        }    
    }	
    // 下载图片
    const downImg = (src) => {
        let a = document.createElement("a")
        a.href = src
        let event = new MouseEvent("click"); // 创建一个单击事件
        a.download = curDuration || "photo"; // 设置图片名称
        a.dispatchEvent(event); // 触发a的单击事件	
        curDuration += time
        video.currentTime = curDuration	        
    }    

</script>
</html>